name: CI com Script Python

on:
  push:
    branches:
      - develop
  workflow_dispatch:

jobs:
  run-python-validation:
    runs-on: ubuntu-latest
    
    steps:
      - name: ‚¨áÔ∏è Checkout do Reposit√≥rio
        uses: actions/checkout@v4

      # Novo Passo: Configurar o Ambiente Python
      - name: üêç Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' # Use a vers√£o mais recente do Python 3

      # --- Etapa de Build (Permanece Simula√ß√£o) ---
      - name: üî® Etapa de Build (Simula√ß√£o de Compila√ß√£o)
        run: echo "Simulando build..."

      # --- Etapa de Testes (Executa o C√≥digo Python) ---
      - name: üß™ Executar Valida√ß√£o Python e Fazer Log
        id: run_validation
        # Voc√™ pode for√ßar uma falha de teste alterando esta linha:
        # env: 
        #   SHOULD_FAIL_TEST: true
        run: |
          echo "Iniciando a execu√ß√£o do script Python..."
          # O GitHub Actions executar√° este script. 
          # Se o script sair com c√≥digo 1, esta etapa FALHAR√Å.
          python validate_code.py

      # --- Etapa de Relat√≥rio Final ---
      - name: üìù Etapa de Relat√≥rio Final
        # always() garante que o relat√≥rio rode mesmo em caso de falha no passo anterior
        if: always() 
        run: |
          echo "--- Relat√≥rio de Status do Pipeline ---"
          # Verifica o resultado da etapa anterior (run_validation)
          if [ "${{ steps.run_validation.outcome }}" == "failure" ]; then
            echo "‚ùå Status: FALHA!"
            echo "Relat√≥rio: O script Python (validate_code.py) retornou um c√≥digo de erro (1)."
            # Se a valida√ß√£o falhou, o pipeline falha
            exit 1
          else
            echo "‚úÖ Status: SUCESSO!"
            echo "Relat√≥rio: Build OK e valida√ß√£o Python conclu√≠da com sucesso."
          fi