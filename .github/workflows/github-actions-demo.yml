# Nome do seu Workflow
name: CI B√°sico na Develop

# Gatilho: Quando o workflow deve ser executado
on:
  # Executa o workflow em cada 'push'
  push:
    # Apenas quando o push for para a branch 'develop'
    branches:
      - develop
  # Tamb√©m permite a execu√ß√£o manual (opcional, mas √∫til para testes)
  workflow_dispatch:

# Defini√ß√£o dos 'jobs' (trabalhos) que ser√£o executados
jobs:
  # O nome do seu primeiro e √∫nico job
  build-and-test:
    # O tipo de runner (m√°quina virtual) a ser usado
    runs-on: ubuntu-latest

    # Defini√ß√£o dos passos (steps)
    steps:
      # Passo 1: Checkout do c√≥digo
      - name: ‚¨áÔ∏è Checkout do Reposit√≥rio
        uses: actions/checkout@v4

      # --- Etapa de Build ---
      - name: üî® Etapa de Build (Simula√ß√£o de Compila√ß√£o)
        id: build_step
        run: |
          echo "Simulando a compila√ß√£o do projeto..."
          # Aqui entraria o comando de build real, como 'npm run build' ou 'mvn package'
          echo "Build successful"
          echo "BUILD_STATUS=SUCCESS" >> $GITHUB_OUTPUT
      
      # --- Etapa de Testes ---
      # Criamos uma simula√ß√£o de sucesso/falha. 
      # Por padr√£o (0), o teste ser√° "bem-sucedido".
      # Para testar a falha, mude '0' para '1'.
      - name: üß™ Etapa de Testes (Simula√ß√£o de Pytest/Valida√ß√£o)
        id: test_step
        # Define que este passo s√≥ ser√° executado se o build for bem-sucedido
        if: ${{ success() }} 
        run: |
          echo "Executando testes..."
          # Simula√ß√£o de um comando de teste que pode falhar
          TEST_EXIT_CODE=0 # 0 = Sucesso. Mude para 1 para simular falha.
          
          if [ $TEST_EXIT_CODE -eq 0 ]; then
            echo "Todos os testes passaram."
            echo "TEST_STATUS=SUCCESS" >> $GITHUB_OUTPUT
            exit 0 # Sai com sucesso
          else
            echo "‚ùå Erro: Alguns testes falharam."
            echo "TEST_STATUS=FAILED" >> $GITHUB_OUTPUT
            exit 1 # Sai com falha para fazer o pipeline parar/falhar
          fi

      # --- Etapa de Relat√≥rio ---
      # Este passo √© crucial para o relat√≥rio e sempre deve rodar (mesmo se o teste falhar)
      - name: üìù Etapa de Relat√≥rio
        if: ${{ always() }} # 'always()' garante que este passo sempre roda
        run: |
          echo "--- Relat√≥rio de CI ---"
          
          # Verifica se o passo de teste falhou
          if [ "${{ steps.test_step.outcome }}" == "failure" ]; then
            echo "‚ùå Pipeline Status: Falha nos Testes"
            echo "Relat√≥rio: Test failed. Por favor, verifique os logs de testes."
            exit 1 # Sai com falha para que o status final do job seja 'failure'
          elif [ "${{ steps.build-and-test.conclusion }}" == "cancelled" ]; then
            echo "‚ö†Ô∏è Pipeline Status: Cancelado"
            echo "Relat√≥rio: O workflow foi cancelado manualmente."
          else
            echo "‚úÖ Pipeline Status: Sucesso"
            echo "Relat√≥rio: Build successful e todos os testes passaram."
          fi